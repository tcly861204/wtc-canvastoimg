"use strict";var _createClass=function(){function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var Canvastoimg=function(){function e(t){_classCallCheck(this,e),t&&(this.timer=null,this.isLoaded=!1,this.options=t,this.initData())}return _createClass(e,[{key:"initData",value:function(){this.options.data.sort(function(t,e){return t.zIndex-e.zIndex}),this.createdCanvas()}},{key:"createdCanvas",value:function(){this.oCanvas=document.createElement("canvas"),this.oCanvas.width=this.options.width,this.oCanvas.height=this.options.height,this.oCtx=this.oCanvas.getContext("2d"),"color"in this.options&&(this.oCtx.fillStyle=this.options.color,this.oCtx.fillRect(0,0,this.oCanvas.width,this.oCanvas.height)),this.createElements()}},{key:"createdArc",value:function(t,e){var i=document.createElement("canvas"),n=i.getContext("2d");i.width=t.x+t.width,i.height=t.y+t.height,n.drawImage(e,t.x,t.y,t.width,t.height);var a=this.oCtx.createPattern(i,"no-repeat");this.oCtx.fillStyle=a,this.oCtx.arc(t.x+t.width/2,t.y+t.width/2,t.width/2,0,2*Math.PI),this.oCtx.fill()}},{key:"createElements",value:function(){var e=this;if(this.options.data.length<1)this.isLoaded=!0;else{var n=this.options.data[0];"text"===n.type?(this.oCtx.fillStyle=n.color,this.oCtx.font=n.fontSize,this.oCtx.textBaseline="top",this.oCtx.textAlign="start",this.oCtx.fillText(n.content,n.x,n.y),this.options.data.shift(),this.createElements()):"img"===n.type&&new Promise(function(t,e){var i=new Image;i.crossOrigin="anonymous",i.src=n.content,i.onload=function(){t(i)}}).then(function(t){"shape"in n&&"arc"===n.shape?e.createdArc(n,t):e.oCtx.drawImage(t,n.x,n.y,n.width,n.height),e.options.data.shift(),e.createElements()})}}},{key:"down",value:function(){var i=this;return new Promise(function(t,e){i.isLoaded?t(i.oCanvas):(clearInterval(i.timer),i.timer=setInterval(function(){i.isLoaded&&t(i.oCanvas)},0))})}}]),e}();module.exports=Canvastoimg;